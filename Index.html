<!doctype html>
<html lang="th">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, viewport-fit=cover"
        />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="default" />
        <title>POS System</title>

        <!-- Firebase SDK -->
        <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>

        <!-- Firebase Integration -->
        <script>
            // Initialize Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyDummyKeyForDevelopment",
                authDomain: "pos-agent-8767b.firebaseapp.com",
                projectId: "pos-agent-8767b",
                storageBucket: "pos-agent-8767b.appspot.com",
                messagingSenderId: "123456789",
                appId: "1:123456789:web:abcdef",
            };

            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();

            // Mock data for development
            const mockData = {
                ingredients: [
                    {
                        id: 1,
                        name: "‡∏Å‡∏∏‡πâ‡∏á",
                        current_stock: 5,
                        min_stock: 3,
                        unit: "kg",
                    },
                    {
                        id: 2,
                        name: "‡πÑ‡∏Å‡πà",
                        current_stock: 2,
                        min_stock: 5,
                        unit: "kg",
                    },
                    {
                        id: 3,
                        name: "‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤",
                        current_stock: 1,
                        min_stock: 3,
                        unit: "‡∏Ç‡∏ß‡∏î",
                    },
                    {
                        id: 4,
                        name: "‡∏´‡∏≠‡∏°‡πÅ‡∏î‡∏á",
                        current_stock: 0.5,
                        min_stock: 1,
                        unit: "kg",
                    },
                    {
                        id: 5,
                        name: "‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°",
                        current_stock: 0.3,
                        min_stock: 1,
                        unit: "kg",
                    },
                ],
                menus: [
                    { id: "A1", name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡πÑ‡∏Å‡πà", price: 89 },
                    { id: "A2", name: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∏‡πâ‡∏á", price: 120 },
                    { id: "A3", name: "‡∏ï‡πâ‡∏°‡∏¢‡∏≥‡∏Å‡∏∏‡πâ‡∏á", price: 150 },
                ],
            };

            // Google Apps Script compatibility layer
            window.google = window.google || {};
            window.google.script = window.google.script || {};

            if (window.google.script.run) {
                console.log("google.script.run already exists, skipping initialization");
            } else {
                window.google.script.run = {
                withSuccessHandler: function (callback) {
                    return {
                        withFailureHandler: function (failureCallback) {
                            return {
                                getLowStockHTML: function () {
                                    console.log("Mock: getLowStockHTML called");
                                    const lowStock =
                                        mockData.ingredients.filter(
                                            (item) =>
                                                item.current_stock <=
                                                item.min_stock,
                                        );
                                    let html = "";
                                    if (lowStock.length === 0) {
                                        html =
                                            '<div class="muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</div>';
                                    } else {
                                        html = lowStock
                                            .map(
                                                (item) =>
                                                    `<div style="padding: 8px; border: 1px solid #e5e7eb; border-radius: 4px; margin-bottom: 4px;">
                                            <strong>${item.name}</strong> - ${item.current_stock} ${item.unit} (‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥: ${item.min_stock} ${item.unit})
                                        </div>`,
                                            )
                                            .join("");
                                    }
                                    setTimeout(() => callback(html), 300);
                                },

                                getIngredients: function () {
                                    console.log("Mock: getIngredients called");
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                data: mockData.ingredients,
                                            }),
                                        300,
                                    );
                                },

                                getMenus: function () {
                                    console.log("Mock: getMenus called");
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                data: mockData.menus,
                                            }),
                                        300,
                                    );
                                },

                                addPurchase: function (data) {
                                    console.log(
                                        "Mock: addPurchase called with:",
                                        data,
                                    );
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                message:
                                                    "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢",
                                            }),
                                        500,
                                    );
                                },

                                agentChat: function (data) {
                                    console.log(
                                        "Mock: agentChat called with:",
                                        data,
                                    );
                                    const responses = [
                                        "‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å " +
                                            (data.message || "‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"),
                                        "‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•",
                                        "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ö‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î",
                                        "‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡πà‡∏∞ ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏´‡∏°?",
                                    ];
                                    const randomResponse =
                                        responses[
                                            Math.floor(
                                                Math.random() *
                                                    responses.length,
                                            )
                                        ];
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                message: randomResponse,
                                            }),
                                        1000,
                                    );
                                },

                                listMissingIngredientPriceData: function (
                                    params,
                                ) {
                                    console.log(
                                        "Mock: listMissingIngredientPriceData with:",
                                        params,
                                    );
                                    const missingData = [
                                        {
                                            ingredient_id: 4,
                                            name: "‡∏´‡∏≠‡∏°‡πÅ‡∏î‡∏á",
                                            unit: "‡∏Å‡∏Å.",
                                            last_updated: null,
                                        },
                                        {
                                            ingredient_id: 5,
                                            name: "‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°",
                                            unit: "‡∏Å‡∏Å.",
                                            last_updated: null,
                                        },
                                    ];
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                missing: missingData,
                                            }),
                                        300,
                                    );
                                },

                                saveSizeMappings: function (data) {
                                    console.log(
                                        "Mock: saveSizeMappings with:",
                                        data,
                                    );
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                message:
                                                    "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢",
                                            }),
                                        300,
                                    );
                                },

                                loadDataHealth: function () {
                                    console.log("Mock: loadDataHealth");
                                    const healthData = {
                                        total_ingredients: 5,
                                        ingredients_with_prices: 3,
                                        ingredients_without_prices: 2,
                                        total_menus: 3,
                                        menus_with_costs: 1,
                                        menus_without_costs: 2,
                                        duplicate_records: 0,
                                        last_updated: new Date().toISOString(),
                                    };
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                data: healthData,
                                            }),
                                        300,
                                    );
                                },

                                getMenuIngredients: function (params) {
                                    console.log(
                                        "Mock: getMenuIngredients with:",
                                        params,
                                    );
                                    const menuIngredients = {
                                        A1: [
                                            {
                                                name: "‡πÑ‡∏Å‡πà",
                                                qty: 0.2,
                                                unit: "‡∏Å‡∏Å.",
                                            },
                                            {
                                                name: "‡πÉ‡∏ö‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤",
                                                qty: 50,
                                                unit: "‡∏Å‡∏£‡∏±‡∏°",
                                            },
                                            {
                                                name: "‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô",
                                                qty: 20,
                                                unit: "‡∏°‡∏•.",
                                            },
                                        ],
                                    };
                                    const ingredients =
                                        menuIngredients[params.menu_id] || [];
                                    const html =
                                        ingredients.length > 0
                                            ? ingredients
                                                  .map(
                                                      (ing) =>
                                                          `<div style="padding: 4px 0; border-bottom: 1px solid #e5e7eb;">
                                            <span>${ing.name}</span>
                                            <span style="float: right; color: #6b7280;">${ing.qty} ${ing.unit}</span>
                                        </div>`,
                                                  )
                                                  .join("")
                                            : '<div class="muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ</div>';
                                    setTimeout(() => callback(html), 300);
                                },

                                getCostingData: function (params) {
                                    console.log(
                                        "Mock: getCostingData with:",
                                        params,
                                    );
                                    const costingData = {
                                        menu_name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡πÑ‡∏Å‡πà",
                                        menu_price: 89,
                                        gp_percentage: 60,
                                        ingredients: [
                                            {
                                                name: "‡πÑ‡∏Å‡πà",
                                                qty: 0.2,
                                                unit: "‡∏Å‡∏Å.",
                                                unit_price: 120,
                                                cost: 24,
                                            },
                                            {
                                                name: "‡πÉ‡∏ö‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤",
                                                qty: 50,
                                                unit: "‡∏Å‡∏£‡∏±‡∏°",
                                                unit_price: 40,
                                                cost: 2,
                                            },
                                        ],
                                        total_cost: 35.6,
                                        recommended_price: 89,
                                        current_gp: 60,
                                    };
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                data: costingData,
                                            }),
                                        300,
                                    );
                                },

                                agentConfirm: function (data) {
                                    console.log(
                                        "Mock: agentConfirm with:",
                                        data,
                                    );
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                message: "‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
                                                confirmed: true,
                                            }),
                                        500,
                                    );
                                },

                                saveIngredientPref: function (data) {
                                    console.log(
                                        "Mock: saveIngredientPref with:",
                                        data,
                                    );
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                message:
                                                    "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢",
                                            }),
                                        300,
                                    );
                                },

                                getSizeMappings: function () {
                                    console.log("Mock: getSizeMappings called");
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                data: {
                                                    ladle_ml: 15,
                                                    items: {
                                                        ‡∏ô‡πâ‡∏≥‡∏à‡∏¥‡πâ‡∏°‡∏ã‡∏µ‡∏ü‡∏π‡πâ‡∏î: {
                                                            ‡πÄ‡∏•‡πá‡∏Å: { qty: 35 },
                                                            ‡πÉ‡∏´‡∏ç‡πà: { qty: 50 },
                                                        },
                                                        ‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤: {
                                                            ‡∏Ç‡∏ß‡∏î: { qty: 1 },
                                                            ‡πÅ‡∏Å‡∏•‡∏•‡∏≠‡∏ô: { qty: 5 },
                                                        },
                                                    },
                                                },
                                            }),
                                        300,
                                    );
                                },

                                getIngredientPrefs: function (data) {
                                    console.log(
                                        "Mock: getIngredientPrefs with:",
                                        data,
                                    );
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                prefs: {
                                                    default_unit: "‡∏Å‡∏Å.",
                                                    default_qty: 1,
                                                },
                                            }),
                                        300,
                                    );
                                },

                                processAIMessage: function (data) {
                                    console.log(
                                        "Mock: processAIMessage with:",
                                        data,
                                    );
                                    const responses = [
                                        "‡∏â‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£",
                                        "‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á",
                                        "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß",
                                        "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
                                    ];
                                    const randomResponse =
                                        responses[
                                            Math.floor(
                                                Math.random() *
                                                    responses.length,
                                            )
                                        ];
                                    setTimeout(
                                        () =>
                                            callback({
                                                status: "ok",
                                                message: randomResponse,
                                                action: "processed",
                                            }),
                                        1000,
                                    );
                                },
                            };
                        },
                    };
                },
            };
        </script>

        <!-- CSS Styles -->
        <style>
            :root {
                --spacing-xs: 0.25rem;
                --spacing-sm: 0.5rem;
                --spacing-md: 1rem;
                --spacing-lg: 1.5rem;
                --spacing-xl: 2rem;
                --spacing-2xl: 3rem;
                --fs-xs: 0.75rem;
                --fs-sm: 0.875rem;
                --fs-md: 1rem;
                --fs-lg: 1.125rem;
                --fs-xl: 1.25rem;
                --fs-2xl: 1.5rem;
                --fs-3xl: 1.875rem;
                --fs-4xl: 2.25rem;
                --brand: #2563eb;
                --brand-ink: #fff;
                --bg: #fff;
                --card: #fff;
                --line: #e5e7eb;
                --muted: #6b7280;
            }

            * {
                box-sizing: border-box;
            }

            html {
                font-size: 16px;
                -webkit-text-size-adjust: 100%;
                text-size-adjust: 100%;
                -webkit-tap-highlight-color: transparent;
            }

            body {
                margin: 0;
                font-family:
                    system-ui,
                    -apple-system,
                    "Segoe UI",
                    Roboto,
                    sans-serif;
                color: #111;
                background: #f6f7fb;
                padding-bottom: env(safe-area-inset-bottom);
            }

            .container {
                width: 100%;
                max-width: min(960px, 100vw - 2rem);
                margin: 0 auto;
                padding: 0 var(--spacing-md);
                padding-left: calc(
                    var(--spacing-md) + env(safe-area-inset-left)
                );
                padding-right: calc(
                    var(--spacing-md) + env(safe-area-inset-right)
                );
            }

            .title {
                font-size: clamp(var(--fs-2xl), 4vw, var(--fs-4xl));
                font-weight: 700;
                margin: var(--spacing-lg) 0 var(--spacing-xs);
            }

            .subtitle {
                font-size: var(--fs-lg);
                color: var(--muted);
                margin-bottom: var(--spacing-lg);
            }

            .dashboard-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: var(--spacing-lg);
                margin-bottom: var(--spacing-xl);
            }

            .card {
                background: var(--card);
                border: 1px solid var(--line);
                border-radius: 14px;
                padding: 16px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            }

            .btn {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                padding: var(--spacing-md) var(--spacing-xl);
                border: 2px solid transparent;
                border-radius: 0.75rem;
                font-size: var(--fs-md);
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s ease;
                text-decoration: none;
                color: #fff;
                background: var(--brand);
                gap: 8px;
            }

            .btn:hover {
                background: #1d4ed8;
                transform: translateY(-1px);
            }

            .btn.ghost {
                background: transparent;
                border-color: var(--brand);
                color: var(--brand);
            }

            .btn.ghost:hover {
                background: var(--brand);
                color: #fff;
            }

            .input {
                width: 100%;
                padding: 12px;
                border: 1px solid var(--line);
                border-radius: 8px;
                font-size: var(--fs-md);
                transition: border-color 0.2s ease;
            }

            .input:focus {
                outline: none;
                border-color: var(--brand);
                box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            }

            .muted {
                color: var(--muted);
                font-size: var(--fs-sm);
            }

            .hide {
                display: none !important;
            }

            /* Tab styles */
            [role="tab"] {
                position: relative;
                cursor: pointer;
            }

            [role="tab"][aria-selected="true"] {
                background: var(--brand);
                color: white;
            }

            /* AI Agent Panel */
            #ai-agent-panel {
                position: fixed;
                z-index: 1001;
                background: white;
                border: 1px solid var(--line);
                border-radius: 14px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
                display: flex;
                flex-direction: column;
                width: 100%;
                max-width: 400px;
                max-height: 600px;
            }

            #ai-agent-panel.hide {
                display: none;
            }

            /* Mobile responsive */
            @media (max-width: 640px) {
                .dashboard-grid {
                    grid-template-columns: 1fr;
                }

                #ai-agent-panel {
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    width: 100%;
                    max-width: 100%;
                    border-radius: 0;
                }
            }
        </style>
    </head>

    <body>
        <main class="container">
            <header>
                <h1 class="title">
                    <?= brand ?>
                    POS & Inventory
                </h1>
                <p class="subtitle">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ç‡∏≤‡∏¢ ¬∑ ‡∏™‡∏ï‡πä‡∏≠‡∏Å ¬∑ ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI</p>
            </header>

            <!-- Quick Actions -->
            <section class="card">
                <h3>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡πá‡∏ß</h3>
                <div style="display: flex; gap: 12px; flex-wrap: wrap">
                    <button class="btn" onclick="showPurchaseForm()">
                        + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠
                    </button>
                    <button class="btn" onclick="showSaleForm()">
                        + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                    </button>
                    <button class="btn ghost" onclick="showReports()">
                        ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                    </button>
                </div>
            </section>

            <!-- Dashboard Grid -->
            <section class="dashboard-grid">
                <!-- Low Stock Alert -->
                <div class="card">
                    <h3>üì¶ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</h3>
                    <div id="low-stock-content">
                        <div class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‚Ä¶</div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="card">
                    <h3>üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                    <div id="data-health" class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‚Ä¶</div>
                </div>

                <!-- AI Assistant -->
                <div class="card">
                    <h3>ü§ñ ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</h3>
                    <p style="font-size: var(--fs-sm); margin: 8px 0">
                        ‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡∏∑‡πâ‡∏≠, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≤‡∏¢, ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏ï‡πä‡∏≠‡∏Å, ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô
                    </p>
                    <button class="btn" onclick="openAIAgent()">
                        ‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI
                    </button>
                </div>
            </section>

            <!-- Admin Panel -->
            <section class="card">
                <h3>‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <div
                    role="tablist"
                    style="
                        display: flex;
                        gap: 8px;
                        flex-wrap: wrap;
                        margin-bottom: 16px;
                    "
                >
                    <button
                        class="btn pill"
                        data-admin-tab="settings"
                        role="tab"
                        aria-selected="true"
                        title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢"
                    >
                        ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                    </button>

                    <button
                        class="btn pill"
                        data-admin-tab="missing"
                        role="tab"
                        aria-selected="false"
                        title="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤"
                    >
                        ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î
                        <span
                            id="badge-missing"
                            style="
                                margin-left: 6px;
                                background: #ef4444;
                                color: #fff;
                                border-radius: 999px;
                                padding: 0 8px;
                                font-size: 12px;
                                line-height: 18px;
                                display: none;
                            "
                            >0</span
                        >
                    </button>

                    <button
                        class="btn pill"
                        data-admin-tab="health"
                        role="tab"
                        aria-selected="false"
                        title="‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö"
                    >
                        ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
                    </button>
                    <button
                        class="btn pill"
                        data-admin-tab="costing"
                        role="tab"
                        aria-selected="false"
                        title="‡∏î‡∏π‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥"
                    >
                        ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô
                    </button>
                </div>

                <!-- Settings Tab -->
                <div id="tab-settings">
                    <h4>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢</h4>
                    <div style="margin-top: 12px">
                        <button class="btn ghost" onclick="loadSizeMappings()">
                            ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                        </button>
                    </div>
                </div>

                <!-- Missing Prices Tab -->
                <div id="tab-missing" class="hide">
                    <div id="missing-price">
                        <div class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‚Ä¶</div>
                    </div>
                    <div
                        style="
                            margin-top: 12px;
                            display: flex;
                            gap: 8px;
                            flex-wrap: wrap;
                        "
                    >
                        <button
                            class="btn ghost"
                            onclick="loadMissingPriceData()"
                        >
                            ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                        </button>
                    </div>
                </div>

                <!-- Data Health Tab -->
                <div id="tab-health" class="hide">
                    <div id="data-health-admin" class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‚Ä¶</div>
                    <div style="margin-top: 12px">
                        <button class="btn ghost" onclick="loadDataHealth()">
                            ‡∏ï‡∏£‡∏ß‡∏à‡∏ã‡πâ‡∏≥
                        </button>
                    </div>
                </div>

                <!-- Costing Tab -->
                <div id="tab-costing" class="hide">
                    <div style="display: grid; gap: 10px">
                        <div
                            style="
                                display: flex;
                                gap: 8px;
                                flex-wrap: wrap;
                                align-items: center;
                            "
                        >
                            <label for="costing-menu" style="min-width: 140px"
                                >‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π</label
                            >
                            <select
                                id="costing-menu"
                                class="input"
                                style="max-width: 280px"
                                title="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô"
                            ></select>
                            <input
                                id="costing-gp"
                                class="input"
                                placeholder="GP (%)"
                                style="max-width: 120px"
                                inputmode="decimal"
                                pattern="[0-9]*"
                                title="‡πÄ‡∏ä‡πà‡∏ô 60"
                                value="60"
                            />
                            <button class="btn" onclick="viewCosting()">
                                ‡∏î‡∏π‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô
                            </button>
                        </div>
                        <div id="costing-view" class="muted">
                            ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏î‡∏π‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- AI Agent Panel -->
        <div id="ai-agent-panel" class="hide">
            <div
                style="
                    padding: 16px;
                    border-bottom: 1px solid var(--line);
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                "
            >
                <h3 style="margin: 0">ü§ñ ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏£‡πâ‡∏≤‡∏ô</h3>
                <button
                    id="ai-close"
                    style="
                        background: none;
                        border: none;
                        font-size: 24px;
                        cursor: pointer;
                        color: var(--muted);
                    "
                >
                    √ó
                </button>
            </div>
            <div
                id="ai-messages"
                style="
                    flex: 1;
                    padding: 16px;
                    overflow-y: auto;
                    min-height: 200px;
                "
            ></div>
            <div style="padding: 16px; border-top: 1px solid var(--line)">
                <input
                    id="ai-input"
                    class="input"
                    placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏ã‡∏∑‡πâ‡∏≠ ‡∏Å‡∏∏‡πâ‡∏á 2 kg 240 ‡∏ö‡∏≤‡∏ó"
                    inputmode="text"
                    enterkeyhint="send"
                />
                <button
                    id="ai-send"
                    class="btn"
                    style="margin-top: 8px; width: 100%"
                >
                    ‡∏™‡πà‡∏á
                </button>
            </div>
        </div>

        <!-- AI Agent Button -->
        <button
            id="ai-agent-button"
            style="
                position: fixed;
                right: 16px;
                bottom: 16px;
                z-index: 1002;
                width: 56px;
                height: 56px;
                border-radius: 50%;
                display: grid;
                place-items: center;
                background: var(--brand);
                color: #fff;
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
                cursor: pointer;
                font-size: 24px;
                border: none;
            "
        >
            ‚ú®
        </button>

        <!-- JavaScript -->
        <script src="CacheManager.js"></script>
        <script src="js/critical.js"></script>

        <script>
            // Initialize app
            // Initialize app when ready
            document.addEventListener("DOMContentLoaded", function () {
                console.log("POS System initialized");

                // Initialize admin tabs
                initAdminTabs();

                // Load initial data
                setTimeout(() => {
                    refreshLowStock();
                    loadDataHealth();
                    loadMissingPriceData();
                    loadSizeMappings();
                }, 500);
            });

            // Admin tabs functionality
            function initAdminTabs() {
                const buttons = document.querySelectorAll("[data-admin-tab]");
                const tabs = {
                    settings: document.getElementById("tab-settings"),
                    missing: document.getElementById("tab-missing"),
                    health: document.getElementById("tab-health"),
                    costing: document.getElementById("tab-costing"),
                };

                function showTab(key) {
                    Object.keys(tabs).forEach((k) => {
                        if (tabs[k])
                            tabs[k].classList.toggle("hide", k !== key);
                    });
                    buttons.forEach((b) =>
                        b.setAttribute(
                            "aria-selected",
                            b.getAttribute("data-admin-tab") === key
                                ? "true"
                                : "false",
                        ),
                    );
                }

                buttons.forEach((b) =>
                    b.addEventListener("click", () =>
                        showTab(b.getAttribute("data-admin-tab")),
                    ),
                );
                showTab("settings");
            }

            // Low stock refresh
            function refreshLowStock() {
                if (
                    !window.google ||
                    !window.google.script ||
                    !window.google.script.run
                ) {
                    return;
                }

                const el = document.getElementById("low-stock-content");
                el.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‚Ä¶";

                window.google.script.run
                    .withSuccessHandler((html) => {
                        el.innerHTML = html;
                    })
                    .withFailureHandler((err) => {
                        el.textContent =
                            "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " +
                            ((err && (err.message || err)) || "unknown");
                    })
                    .getLowStockHTML();
            }

            // Data health
            function loadDataHealth() {
                if (
                    !window.google ||
                    !window.google.script ||
                    !window.google.script.run
                ) {
                    return;
                }

                const el = document.getElementById("data-health-admin");
                el.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‚Ä¶";

                window.google.script.run
                    .withSuccessHandler((resp) => {
                        if (!resp || resp.status !== "ok") {
                            el.textContent = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ";
                            return;
                        }

                        const data = resp.data;
                        el.innerHTML = `
                        <div style="display: grid; gap: 8px;">
                            <div>‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong>${data.total_ingredients}</strong></div>
                            <div>‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤: <strong>${data.ingredients_with_prices}</strong></div>
                            <div>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤: <strong>${data.ingredients_without_prices}</strong></div>
                            <div>‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong>${data.total_menus}</strong></div>
                        </div>
                    `;
                    })
                    .withFailureHandler(() => {
                        el.textContent = "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ";
                    })
                    .loadDataHealth();
            }

            // Missing price data
            function loadMissingPriceData() {
                if (
                    !window.google ||
                    !window.google.script ||
                    !window.google.script.run
                ) {
                    return;
                }

                const box = document.getElementById("missing-price");
                if (box) box.innerHTML = '<div class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‚Ä¶</div>';

                window.google.script.run
                    .withSuccessHandler((resp) => {
                        if (!resp || resp.status !== "ok") {
                            if (box)
                                box.innerHTML =
                                    '<div class="muted">‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>';
                            return;
                        }

                        renderMissingPrice(resp);
                    })
                    .withFailureHandler(() => {
                        if (box)
                            box.innerHTML =
                                '<div class="muted">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</div>';
                    })
                    .listMissingIngredientPriceData({ daysBack: 365 });
            }

            function renderMissingPrice(resp) {
                var box = document.getElementById("missing-price");
                if (!box) return;

                var missing = resp.missing || [];
                var badge = document.getElementById("badge-missing");
                if (badge) {
                    badge.textContent = String(missing.length);
                    badge.style.display = missing.length
                        ? "inline-block"
                        : "none";
                }

                if (missing.length === 0) {
                    box.innerHTML =
                        '<div class="muted">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢</div>';
                    return;
                }

                var html = missing
                    .map(
                        (item) =>
                            `<div style="padding: 8px; border: 1px solid var(--line); border-radius: 4px; margin-bottom: 8px;">
                    <strong>${item.name}</strong> - ${item.unit}
                </div>`,
                    )
                    .join("");

                box.innerHTML = html;
            }

            // Size mappings
            function loadSizeMappings() {
                if (
                    !window.google ||
                    !window.google.script ||
                    !window.google.script.run
                ) {
                    return;
                }

                window.google.script.run
                    .withSuccessHandler((resp) => {
                        if (!resp || resp.status !== "ok") {
                            console.error("Failed to load size mappings");
                            return;
                        }
                        console.log("Size mappings loaded:", resp.data);
                    })
                    .withFailureHandler(() => {
                        console.error("Failed to load size mappings");
                    })
                    .getSizeMappings();
            }

            // Costing
            function viewCosting() {
                if (
                    !window.google ||
                    !window.google.script ||
                    !window.google.script.run
                ) {
                    return;
                }

                const menuId = document.getElementById("costing-menu").value;
                const gp = Number(
                    document.getElementById("costing-gp").value || "60",
                );

                if (!menuId) {
                    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π");
                    return;
                }

                const view = document.getElementById("costing-view");
                view.innerHTML = '<div class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‚Ä¶</div>';

                window.google.script.run
                    .withSuccessHandler((resp) => {
                        if (!resp || resp.status !== "ok") {
                            view.innerHTML =
                                '<div class="muted">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ</div>';
                            return;
                        }

                        const data = resp.data;
                        view.innerHTML = `
                        <div style="padding: 16px; border: 1px solid var(--line); border-radius: 8px;">
                            <h4>${data.menu_name}</h4>
                            <div style="margin-bottom: 12px;">
                                <strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢:</strong> ${data.menu_price} ‡∏ö‡∏≤‡∏ó<br>
                                <strong>‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°:</strong> ${data.total_cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó<br>
                                <strong>‡∏Å‡∏≥‡πÑ‡∏£:</strong> ${(((data.menu_price - data.total_cost) / data.menu_price) * 100).toFixed(1)}%
                            </div>
                            <h5>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:</h5>
                            ${data.ingredients
                                .map(
                                    (ing) =>
                                        `<div style="display: flex; justify-content: space-between; padding: 4px 0;">
                                        <span>${ing.name} ${ing.qty} ${ing.unit}</span>
                                        <span>${ing.cost.toFixed(2)} ‡∏ö‡∏≤‡∏ó</span>
                                    </div>`,
                                )
                                .join("")}
                        </div>
                    `;
                    })
                    .withFailureHandler(() => {
                        view.innerHTML =
                            '<div class="muted">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ</div>';
                    })
                    .getCostingData({ menu_id: menuId, gp: gp });
            }

            // AI Agent
            function setupAIAgent() {
                const panel = document.getElementById("ai-agent-panel");
                const button = document.getElementById("ai-agent-button");
                const closeBtn = document.getElementById("ai-close");
                const sendBtn = document.getElementById("ai-send");
                const input = document.getElementById("ai-input");
                const messages = document.getElementById("ai-messages");

                button.addEventListener("click", openAIAgent);
                closeBtn.addEventListener("click", closeAIAgent);
                sendBtn.addEventListener("click", sendAIMessage);
                input.addEventListener("keydown", (e) => {
                    if (e.key === "Enter") sendAIMessage();
                });

                function openAIAgent() {
                    panel.classList.remove("hide");
                    input.focus();
                }

                function closeAIAgent() {
                    panel.classList.add("hide");
                }

                function sendAIMessage() {
                    const message = input.value.trim();
                    if (!message) return;

                    // Add user message
                    messages.innerHTML += `
                    <div style="margin-bottom: 12px;">
                        <div style="background: #e5e7eb; padding: 8px 12px; border-radius: 12px 12px 4px 12px; display: inline-block; max-width: 80%;">
                            <strong>‡∏Ñ‡∏∏‡∏ì:</strong> ${message}
                        </div>
                    </div>
                `;

                    input.value = "";

                    // Add loading message
                    messages.innerHTML += `
                    <div style="margin-bottom: 12px;">
                        <div style="background: var(--brand); color: white; padding: 8px 12px; border-radius: 12px 12px 4px 12px; display: inline-block; max-width: 80%;">
                            <strong>‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏£‡πâ‡∏≤‡∏ô:</strong> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‚Ä¶
                        </div>
                    </div>
                `;

                    messages.scrollTop = messages.scrollHeight;

                    // Call AI
                    window.google.script.run
                        .withSuccessHandler((resp) => {
                            if (!resp || resp.status !== "ok") return;

                            // Remove loading message and add AI response
                            messages.innerHTML = messages.innerHTML.replace(
                                /<div[^>]*>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•\.\.\.<\/div>/,
                                `
                            <div style="background: var(--brand); color: white; padding: 8px 12px; border-radius: 12px 12px 4px 12px; display: inline-block; max-width: 80%;">
                                <strong>‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏£‡πâ‡∏≤‡∏ô:</strong> ${resp.message}
                            </div>
                        `,
                            );
                            messages.scrollTop = messages.scrollHeight;
                        })
                        .withFailureHandler(() => {
                            // Remove loading message and add error
                            messages.innerHTML = messages.innerHTML.replace(
                                /<div[^>]*>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•\.\.\.<\/div>/,
                                `
                            <div style="background: #ef4444; color: white; padding: 8px 12px; border-radius: 12px 12px 4px 12px; display: inline-block; max-width: 80%;">
                                <strong>‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏£‡πâ‡∏≤‡∏ô:</strong> ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
                            </div>
                        `,
                            );
                            messages.scrollTop = messages.scrollHeight;
                        })
                        .agentChat({ message: message });
                }
            }

            function openAIAgent() {
                setupAIAgent(); // Ensure AI is set up
                document
                    .getElementById("ai-agent-panel")
                    .classList.remove("hide");
            }
        </script>
    </body>
</html>
