<!doctype html>
<html lang="th">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>POS & Inventory - Supabase Version</title>

        <!-- Supabase SDK -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <script>
            // Make supabase available globally
            window.supabaseLib = supabase;
        </script>

        <!-- Tailwind CSS -->
        <script src="https://cdn.tailwindcss.com"></script>

        <!-- PWA Manifest -->
        <link rel="manifest" href="manifest.json" />
        <meta name="theme-color" content="#0f766e" />

        <style>
            :root {
                --spacing-xs: 0.25rem;
                --spacing-sm: 0.5rem;
                --spacing-md: 1rem;
                --spacing-lg: 1.5rem;
                --spacing-xl: 2rem;
                --spacing-2xl: 3rem;
                --fs-xs: 0.75rem;
                --fs-sm: 0.875rem;
                --fs-md: 1rem;
                --fs-lg: 1.125rem;
                --fs-xl: 1.25rem;
                --fs-2xl: 1.5rem;
                --fs-3xl: 1.875rem;
                --fs-4xl: 2.25rem;
                --muted: #6b7280;
                --brand: #0891b2;
                --brand-ink: #ffffff;
                --card: #ffffff;
                --line: #e5e7eb;
                --bg: #f8fafc;
            }

            * {
                box-sizing: border-box;
            }

            body {
                font-family:
                    system-ui,
                    -apple-system,
                    sans-serif;
                color: #111;
                background: #f6f7fb;
                padding-bottom: env(safe-area-inset-bottom);
                margin: 0;
                padding: 0;
            }

            .container {
                width: 100%;
                max-width: min(960px, 100vw - 2rem);
                margin: 0 auto;
                padding: 0 var(--spacing-md);
            }
            .card {
                background: var(--card);
                border: 1px solid var(--line);
                border-radius: 14px;
                padding: 16px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
                margin-bottom: var(--spacing-md);
            }
            .btn {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                padding: var(--spacing-md) var(--spacing-xl);
                border: 2px solid transparent;
                border-radius: 0.75rem;
                font-size: var(--fs-md);
                font-weight: 600;
                cursor: pointer;
                min-height: 44px;
                text-decoration: none;
            }
            .btn.brand {
                background: var(--brand);
                color: var(--brand-ink);
            }
            .btn.ghost {
                background: #fff;
                border-color: var(--line);
                color: #111;
            }
            .input {
                width: 100%;
                padding: var(--spacing-md);
                border: 2px solid #e5e7eb;
                border-radius: 0.75rem;
                font-size: var(--fs-md);
                background: #fff;
            }
            .input:focus {
                outline: none;
                border-color: var(--brand);
                box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            }
            .supabase-status {
                position: fixed;
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
                z-index: 1000;
            }
            .supabase-status.connected {
                background: #10b981;
                color: #fff;
            }
            .supabase-status.disconnected {
                background: #ef4444;
                color: #fff;
            }
            .supabase-status.demo {
                background: #f59e0b;
                color: #fff;
            }
            .spinner {
                border: 3px solid #f3f4f6;
                border-top: 3px solid #0891b2;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }
            .hidden {
                display: none !important;
            }
            @media (max-width: 768px) {
                .container {
                    padding: 0 var(--spacing-sm);
                }
            }
        </style>
    </head>
    <body>
        <!-- Supabase Status Indicator -->
        <div id="supabase-status" class="supabase-status disconnected">
            üî¥ Disconnected
        </div>

        <!-- Authentication Screen -->
        <div id="auth-screen" class="container">
            <div class="card" style="max-width: 400px; margin: 50px auto">
                <h2 class="text-2xl font-bold mb-6">POS System Login</h2>

                <!-- Google Sign-In Button -->
                <button
                    id="google-signin-btn"
                    class="btn ghost w-full mb-4"
                    style="
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 8px;
                    "
                >
                    <svg
                        width="18"
                        height="18"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 48 48"
                    >
                        <path
                            fill="#EA4335"
                            d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"
                        />
                        <path
                            fill="#4285F4"
                            d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"
                        />
                        <path
                            fill="#FBBC05"
                            d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"
                        />
                        <path
                            fill="#34A853"
                            d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"
                        />
                        <path fill="none" d="M0 0h48v48H0z" />
                    </svg>
                    <span>Sign in with Google</span>
                </button>

                <div class="relative mb-4">
                    <div class="absolute inset-0 flex items-center">
                        <div class="w-full border-t border-gray-300"></div>
                    </div>
                    <div class="relative flex justify-center text-sm">
                        <span class="px-2 bg-white text-gray-500"
                            >Or continue with email</span
                        >
                    </div>
                </div>

                <form id="login-form">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2"
                            >Email</label
                        >
                        <input
                            type="email"
                            id="email"
                            class="input"
                            required
                            placeholder="your@email.com"
                        />
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2"
                            >Password</label
                        >
                        <input
                            type="password"
                            id="password"
                            class="input"
                            required
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        />
                    </div>
                    <button type="submit" class="btn brand w-full">
                        <span id="login-btn-text">Sign In</span>
                        <div
                            id="login-spinner"
                            class="spinner hidden"
                            style="width: 20px; height: 20px; margin-left: 10px"
                        ></div>
                    </button>
                </form>
                <div
                    id="login-error"
                    class="mt-4 p-3 bg-red-100 text-red-700 rounded hidden"
                ></div>
            </div>
        </div>

        <!-- Main POS Application -->
        <div id="pos-app" class="container hidden">
            <header>
                <h1 class="text-3xl font-bold mb-2">POS & Inventory</h1>
                <p class="text-gray-600">
                    ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ç‡∏≤‡∏¢ ¬∑ ‡∏™‡∏ï‡πä‡∏≠‡∏Å ¬∑ ‡πÅ‡∏ö‡∏ö Real-time
                </p>
            </header>

            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-6">
                <div class="card">
                    <h3 class="font-semibold mb-3">üõí ‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <button onclick="openSaleModal()" class="btn brand w-full">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                    </button>
                </div>
                <div class="card">
                    <h3 class="font-semibold mb-3">üì¶ ‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h3>
                    <button
                        onclick="openPurchaseModal()"
                        class="btn brand w-full"
                    >
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠
                    </button>
                </div>
                <div class="card">
                    <h3 class="font-semibold mb-3">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
                    <button onclick="showReports()" class="btn ghost w-full">
                        ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                    </button>
                </div>
            </div>

            <!-- Real-time Stock Status -->
            <div class="card">
                <h3 class="font-semibold mb-3">üö® ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î (Real-time)</h3>
                <div id="low-stock-list">
                    <div class="spinner" style="margin: 20px auto"></div>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="card">
                <h3 class="font-semibold mb-3">üìù ‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                <div id="recent-transactions">
                    <div class="spinner" style="margin: 20px auto"></div>
                </div>
            </div>

            <!-- User Info -->
            <div class="card mt-6">
                <div class="flex justify-between items-center">
                    <div>
                        <span class="text-sm text-gray-600">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: </span>
                        <span id="user-email" class="font-medium"></span>
                    </div>
                    <div class="flex gap-2">
                        <button
                            onclick="initializeSeedData()"
                            class="btn ghost text-sm"
                        >
                            üå± Seed Data
                        </button>
                        <button
                            onclick="initializeGoogleSheets()"
                            class="btn ghost text-sm"
                        >
                            üìä Connect Sheets
                        </button>
                        <button
                            onclick="initializeLineBot()"
                            class="btn ghost text-sm"
                        >
                            üí¨ Line Bot
                        </button>
                        <button
                            onclick="showDebugPanel()"
                            class="btn ghost text-sm"
                        >
                            üîç Debug
                        </button>
                        <button onclick="logout()" class="btn ghost">
                            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sale Modal -->
        <div
            id="sale-modal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50"
        >
            <div class="card max-w-md w-full mx-4">
                <h3 class="text-xl font-bold mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h3>
                <form id="sale-form">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2"
                            >‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°</label
                        >
                        <select id="sale-platform" class="input">
                            <option value="‡∏£‡πâ‡∏≤‡∏ô">‡∏£‡πâ‡∏≤‡∏ô</option>
                            <option value="Grab">Grab</option>
                            <option value="FoodPanda">FoodPanda</option>
                            <option value="Line Man">Line Man</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2"
                            >‡πÄ‡∏°‡∏ô‡∏π</label
                        >
                        <select id="sale-menu" class="input">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π...</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2"
                            >‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label
                        >
                        <input
                            type="number"
                            id="sale-qty"
                            class="input"
                            min="1"
                            value="1"
                        />
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2"
                            >‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</label
                        >
                        <input
                            type="number"
                            id="sale-price"
                            class="input"
                            min="0"
                            step="0.01"
                        />
                    </div>
                    <div class="flex gap-2">
                        <button type="submit" class="btn brand flex-1">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
                        </button>
                        <button
                            type="button"
                            onclick="closeSaleModal()"
                            class="btn ghost flex-1"
                        >
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Purchase Modal -->
        <div
            id="purchase-modal"
            class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50"
        >
            <div class="card max-w-md w-full mx-4">
                <h3 class="text-xl font-bold mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</h3>
                <form id="purchase-form">
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2"
                            >‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</label
                        >
                        <select id="purchase-ingredient" class="input">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö...</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2"
                            >‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label
                        >
                        <input
                            type="number"
                            id="purchase-qty"
                            class="input"
                            min="0"
                            step="0.01"
                        />
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2"
                            >‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</label
                        >
                        <input
                            type="number"
                            id="purchase-price"
                            class="input"
                            min="0"
                            step="0.01"
                        />
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium mb-2"
                            >‡∏´‡∏ô‡πà‡∏ß‡∏¢</label
                        >
                        <input
                            type="text"
                            id="purchase-unit"
                            class="input"
                            placeholder="‡∏Å‡∏Å., ‡∏•‡∏¥‡∏ï‡∏£"
                        />
                    </div>
                    <div class="flex gap-2">
                        <button type="submit" class="btn brand flex-1">
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠
                        </button>
                        <button
                            type="button"
                            onclick="closePurchaseModal()"
                            class="btn ghost flex-1"
                        >
                            ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Toast Notification -->
        <div
            id="toast"
            class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-full opacity-0 transition-opacity duration-200 pointer-events-none z-50"
        ></div>

        <!-- Google APIs for Sheets Integration -->
        <script async defer src="https://apis.google.com/js/api.js"></script>
        <script
            async
            defer
            src="https://apis.google.com/js/platform.js"
        ></script>

        <!-- Configuration -->
        <script src="config/integrations.js"></script>

        <!-- Scripts -->
        <script src="supabase-config.js"></script>
        <script src="pos-app.js"></script>
    </body>
</html>
