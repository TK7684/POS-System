<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Features Test - POS ‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡∏∏‡πâ‡∏á‡πÅ‡∏ã‡πà‡∏ö</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="css/critical.css">
    <link rel="stylesheet" href="css/pwa.css">
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8fafc;
            color: #1e293b;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #0f766e;
        }
        .test-button {
            background: #0f766e;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
        }
        .test-button:hover {
            background: #14b8a6;
        }
        .test-result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
        }
        .success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        .error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        .info {
            background: #eff6ff;
            color: #1d4ed8;
            border: 1px solid #dbeafe;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ PWA Features Test</h1>
        <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå PWA ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö POS</p>

        <!-- Installation Test -->
        <div class="test-section">
            <h3>üì± ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ</h3>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ‡πÅ‡∏•‡∏∞ install prompt</p>
            <button class="test-button" onclick="testInstallation()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</button>
            <button class="test-button" onclick="showInstallInstructions()">‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</button>
            <div id="install-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- Notification Test -->
        <div class="test-section">
            <h3>üîî ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</p>
            <button class="test-button" onclick="testNotificationPermission()">‡∏Ç‡∏≠‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
            <button class="test-button" onclick="testLocalNotification()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô</button>
            <button class="test-button" onclick="showNotificationPanel()">‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ú‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
            <button class="test-button" onclick="testCriticalAlert()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</button>
            <div id="notification-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- Service Worker Test -->
        <div class="test-section">
            <h3>‚öôÔ∏è Service Worker</h3>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö Service Worker ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</p>
            <button class="test-button" onclick="testServiceWorker()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Service Worker</button>
            <button class="test-button" onclick="testCacheStatus()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cache</button>
            <button class="test-button" onclick="testOfflineMode()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</button>
            <div id="sw-result" class="test-result" style="display: none;"></div>
        </div>

        <!-- PWA Features Test -->
        <div class="test-section">
            <h3>üöÄ PWA Features</h3>
            <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå PWA ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</p>
            <button class="test-button" onclick="testManifest()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Manifest</button>
            <button class="test-button" onclick="testStandaloneMode()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏´‡∏°‡∏î Standalone</button>
            <button class="test-button" onclick="testAppShortcuts()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö App Shortcuts</button>
            <div id="pwa-result" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <!-- Load PWA Scripts -->
    <script src="js/core/PWAInstaller.js"></script>
    <script src="js/core/NotificationManager.js"></script>

    <script>
        // Initialize PWA components
        let pwaInstaller, notificationManager;

        window.addEventListener('load', () => {
            pwaInstaller = new PWAInstaller();
            notificationManager = new NotificationManager();
            
            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('Service worker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service worker registration failed:', error);
                    });
            }
        });

        // Test functions
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `test-result ${type}`;
            element.style.display = 'block';
        }

        function testInstallation() {
            const isInstalled = pwaInstaller.isInstalled;
            const hasPrompt = !!pwaInstaller.deferredPrompt;
            
            let message = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á: ${isInstalled ? '‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á'}\n`;
            message += `Install Prompt: ${hasPrompt ? '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°'}`;
            
            showResult('install-result', message, isInstalled ? 'success' : 'info');
        }

        function showInstallInstructions() {
            pwaInstaller.showInstallPrompt();
            showResult('install-result', '‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        async function testNotificationPermission() {
            const granted = await notificationManager.requestPermission();
            showResult('notification-result', 
                `‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ${granted ? '‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï' : '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò'}`, 
                granted ? 'success' : 'error'
            );
        }

        async function testLocalNotification() {
            await notificationManager.showNotification('üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', {
                body: '‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô',
                tag: 'test-notification'
            });
            showResult('notification-result', '‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        function showNotificationPanel() {
            notificationManager.showNotificationPanel();
            showResult('notification-result', '‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        async function testCriticalAlert() {
            await notificationManager.showCriticalAlert('‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö');
            showResult('notification-result', '‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        async function testServiceWorker() {
            if ('serviceWorker' in navigator) {
                const registration = await navigator.serviceWorker.ready;
                const isActive = !!registration.active;
                showResult('sw-result', 
                    `Service Worker: ${isActive ? '‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥' : '‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô'}`, 
                    isActive ? 'success' : 'error'
                );
            } else {
                showResult('sw-result', '‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Service Worker', 'error');
            }
        }

        async function testCacheStatus() {
            if ('caches' in window) {
                const cacheNames = await caches.keys();
                const totalCaches = cacheNames.length;
                showResult('sw-result', 
                    `‡∏û‡∏ö Cache ${totalCaches} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: ${cacheNames.join(', ')}`, 
                    totalCaches > 0 ? 'success' : 'info'
                );
            } else {
                showResult('sw-result', '‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Cache API', 'error');
            }
        }

        function testOfflineMode() {
            const isOnline = navigator.onLine;
            showResult('sw-result', 
                `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢: ${isOnline ? '‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå' : '‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå'}`, 
                isOnline ? 'success' : 'info'
            );
        }

        async function testManifest() {
            try {
                const response = await fetch('/manifest.json');
                const manifest = await response.json();
                showResult('pwa-result', 
                    `Manifest ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${manifest.name} (${manifest.short_name})`, 
                    'success'
                );
            } catch (error) {
                showResult('pwa-result', `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î Manifest: ${error.message}`, 'error');
            }
        }

        function testStandaloneMode() {
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches ||
                                window.navigator.standalone === true;
            showResult('pwa-result', 
                `‡πÇ‡∏´‡∏°‡∏î Standalone: ${isStandalone ? '‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'}`, 
                isStandalone ? 'success' : 'info'
            );
        }

        function testAppShortcuts() {
            // Test if shortcuts are working by checking manifest
            fetch('/manifest.json')
                .then(response => response.json())
                .then(manifest => {
                    const shortcuts = manifest.shortcuts || [];
                    showResult('pwa-result', 
                        `App Shortcuts: ‡∏û‡∏ö ${shortcuts.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`, 
                        shortcuts.length > 0 ? 'success' : 'info'
                    );
                })
                .catch(error => {
                    showResult('pwa-result', `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Shortcuts: ${error.message}`, 'error');
                });
        }

        // Listen for PWA events
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('Install prompt available');
            showResult('install-result', 'Install prompt ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!', 'success');
        });

        window.addEventListener('appinstalled', (e) => {
            console.log('App installed');
            showResult('install-result', '‡πÅ‡∏≠‡∏õ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        });
    </script>
</body>
</html>